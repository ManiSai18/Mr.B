{% extends 'budget/base.html' %}
{% block content %}
<div class="container py-5">

  <div class="text-center mb-4">
    <h2 class="fw-bold">Welcome {{ user_name }}!</h2>
  </div>

  {% if has_plans %}
    <div class="mb-5">
      <h4 class="text-center mb-4">Your Plans Overview</h4>
      <canvas id="planChart" class="mb-4 mx-auto" style="max-width: 100%;"></canvas>
      
      <div class="row g-3">
        <div class="col-12 col-md-4">
          <a href="{% url 'plan_list' %}" class="btn btn-outline-primary w-100 rounded-pill py-3 shadow-sm">
            ðŸ“‹ View All Plans
          </a>
        </div>
        <div class="col-12 col-md-4">
          <a href="{% url 'all_persons' %}" class="btn btn-outline-info w-100 rounded-pill py-3 shadow-sm">
            ðŸ‘¥ View All Persons
          </a>
        </div>
        <div class="col-12 col-md-4">
          <a href="{% url 'all_payments' %}" class="btn btn-outline-warning w-100 rounded-pill py-3 shadow-sm">
            ðŸ’³ View All Payment Methods
          </a>
        </div>
      </div>
    </div>

    <div class="row g-4">
      {% for plan in plans %}
        <div class="col-sm-6 col-lg-4">
          <div class="card shadow h-100">
            <div class="card-body">
              <h5 class="card-title">{{ plan.title }}</h5>
              <p class="card-text">
                Budget: ${{ plan.initial_budget }}<br>
                People: {{ plan.people_number }}<br>
                Duration: {{ plan.from_date }} â†’ {{ plan.to_date }}<br>
                Total Spent: ${{ plan.total_spent }}
              </p>
              <div class="d-flex justify-content-between">
                <a href="{% url 'view_plan' plan.plan_id %}" class="btn btn-sm btn-primary">View</a>
                <a href="{% url 'expense_distribution' plan.plan_id %}" class="btn btn-sm btn-success">Distribution</a>
                <a href="{% url 'plan_detail' plan.plan_id %}" class="btn btn-sm btn-secondary">Edit</a>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

  {% else %}
    <h4 class="text-center mb-4">You don't have any Active Plans.</h4>
    <div class="text-center">
      <a href="{% url 'create_plan' %}" class="btn btn-success btn-lg rounded-pill px-4">
        <span class="glyphicon glyphicon-plus-sign"></span> Create New Plan
      </a>
    </div>
  {% endif %}

</div>

{% if has_plans %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('planChart').getContext('2d');
  const planData = {
    labels: {{ chart_labels|safe }},
    datasets: [
      { label: 'Budget', backgroundColor: '#007bff', data: {{ chart_budget|safe }} },
      { label: 'Spent', backgroundColor: '#dc3545', data: {{ chart_spent|safe }} }
    ]
  };

  new Chart(ctx, {
    type: 'bar',
    data: planData,
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: { y: { beginAtZero: true } }
    }
  });
</script>
{% endif %}
{% endblock %}
